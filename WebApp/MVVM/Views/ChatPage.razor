@page "/chat/{chatId:int}"
@using Microsoft.AspNetCore.Components
@using Ready4Hire.MVVM.Models
@using Ready4Hire.Services
@using System.Text.Json
@rendermode InteractiveServer
@attribute [StreamRendering(false)]
@inject IJSRuntime JSRuntime

<script src="~/js/audio-utils.js"></script>

<PageTitle>Chat @chatId - Ready4Hire</PageTitle>

<div class="modern-chat-container-full">
    <!-- Header del Chat -->
    <div class="chat-header">
        <div class="header-left">
            <div class="agent-avatar">
                <div class="avatar-icon">ğŸ¤–</div>
                <div class="status-indicator"></div>
            </div>
            <div class="agent-info">
                <h3 class="greeting-centered">Hola, @GetUserName()! ğŸ‘‹</h3>
                <p class="status-text">
                    @if (started)
                    {
                        <span class="status-active">ğŸŸ¢ Entrevista en progreso</span>
                    }
                    else
                    {
                        <span class="status-idle">âš« Configurando entrevista</span>
                    }
                </p>
            </div>
        </div>
        
        <div class="header-controls">
            @if (isExamMode && started)
            {
                <div class="timer-display">
                    <span class="timer-icon">â±ï¸</span>
                    <span class="timer-text">@FormatTime(elapsedSeconds)</span>
                </div>
            }
            
            <div class="progress-indicator">
                @if (currentPhase == "context")
                {
                    <span class="phase-badge context">ğŸ“ Contexto (@contextQuestionsAnswered/5)</span>
                }
                else if (currentPhase == "technical" || currentPhase == "soft_skills")
                {
                    <span class="phase-badge interview">ğŸ¯ Preguntas TÃ©cnicas (@questionCount/@totalTechnicalQuestions)</span>
                }
                else if (currentPhase == "completed")
                {
                    <span class="phase-badge completed">âœ… Completada</span>
                }
            </div>
        </div>
    </div>

    <!-- ConfiguraciÃ³n de la Entrevista -->
    @if (!started)
    {
        <div class="interview-config">
            <div class="config-header">
                <h2>ğŸš€ Configurar Entrevista</h2>
                <p>Chat ID: <strong>@chatId</strong> - Configura tu entrevista personalizada.</p>
            </div>

            <!-- InformaciÃ³n de Debug para ConfiguraciÃ³n -->
            @if (!string.IsNullOrEmpty(errorMessage))
            {
                <div class="error-message-config">
                    <div class="error-content">
                        <span class="error-icon">âš ï¸</span>
                        <div class="error-text">@errorMessage</div>
                    </div>
                    <div class="error-actions">
                        <button class="btn-retry" @onclick="ClearError">Continuar en Modo Demo</button>
                    </div>
                </div>
            }

            <div class="config-grid">
                <!-- SelecciÃ³n de Rol -->
                <div class="config-section">
                    <label class="config-label">
                        <span class="label-icon">ğŸ’¼</span>
                        <span class="label-text">Rol o PosiciÃ³n</span>
                    </label>
                    <select @bind="SelectedRole" class="config-select">
                        <option value="">Selecciona un rol...</option>
                        
                        <!-- TECNOLOGÃA E INFORMÃTICA -->
                        <optgroup label="ğŸ’» TecnologÃ­a e InformÃ¡tica">
                            <option value="Software Developer">ğŸ‘¨â€ğŸ’» Desarrollador de Software</option>
                            <option value="Frontend Developer">ğŸ¨ Desarrollador Frontend</option>
                            <option value="Backend Developer">âš™ï¸ Desarrollador Backend</option>
                            <option value="Full Stack Developer">ğŸ”„ Desarrollador Full Stack</option>
                            <option value="DevOps Engineer">ğŸš€ Ingeniero DevOps</option>
                            <option value="Data Scientist">ğŸ“Š CientÃ­fico de Datos</option>
                            <option value="Product Manager">ğŸ“‹ Product Manager</option>
                            <option value="UX/UI Designer">ğŸ¨ DiseÃ±ador UX/UI</option>
                            <option value="QA Engineer">ğŸ§ª Ingeniero QA</option>
                            <option value="Mobile Developer">ğŸ“± Desarrollador MÃ³vil</option>
                            <option value="Cloud Architect">â˜ï¸ Arquitecto Cloud</option>
                            <option value="Cybersecurity Analyst">ğŸ”’ Analista de Ciberseguridad</option>
                            <option value="AI/ML Engineer">ğŸ¤– Ingeniero IA/ML</option>
                        </optgroup>

                        <!-- SALUD Y MEDICINA -->
                        <optgroup label="ğŸ¥ Salud y Medicina">
                            <option value="Doctor">ğŸ‘¨â€âš•ï¸ MÃ©dico</option>
                            <option value="Nurse">ğŸ‘©â€âš•ï¸ Enfermero/a</option>
                            <option value="Dentist">ğŸ¦· Dentista</option>
                            <option value="Pharmacist">ğŸ’Š FarmacÃ©utico</option>
                            <option value="Psychologist">ğŸ§  PsicÃ³logo</option>
                            <option value="Physical Therapist">ğŸƒâ€â™‚ï¸ Fisioterapeuta</option>
                            <option value="Nutritionist">ğŸ¥— Nutricionista</option>
                            <option value="Veterinarian">ğŸ• Veterinario</option>
                        </optgroup>

                        <!-- EDUCACIÃ“N -->
                        <optgroup label="ğŸ“š EducaciÃ³n">
                            <option value="Teacher">ğŸ‘¨â€ğŸ« Profesor</option>
                            <option value="Principal">ğŸ« Director Escolar</option>
                            <option value="Tutor">ğŸ“– Tutor</option>
                            <option value="Educational Counselor">ğŸ¯ Orientador Educativo</option>
                            <option value="Librarian">ğŸ“š Bibliotecario</option>
                            <option value="Training Specialist">ğŸ“ Especialista en CapacitaciÃ³n</option>
                        </optgroup>

                        <!-- NEGOCIOS Y FINANZAS -->
                        <optgroup label="ğŸ’¼ Negocios y Finanzas">
                            <option value="Financial Analyst">ğŸ“ˆ Analista Financiero</option>
                            <option value="Accountant">ğŸ§® Contador</option>
                            <option value="Investment Advisor">ğŸ’° Asesor de Inversiones</option>
                            <option value="Business Analyst">ğŸ“Š Analista de Negocios</option>
                            <option value="Operations Manager">âš™ï¸ Gerente de Operaciones</option>
                            <option value="Project Manager">ğŸ“‹ Gerente de Proyectos</option>
                            <option value="Consultant">ğŸ¤ Consultor</option>
                            <option value="Entrepreneur">ğŸš€ Emprendedor</option>
                        </optgroup>

                        <!-- MARKETING Y VENTAS -->
                        <optgroup label="ğŸ“¢ Marketing y Ventas">
                            <option value="Marketing Manager">ğŸ“± Gerente de Marketing</option>
                            <option value="Sales Representative">ğŸ¤ Representante de Ventas</option>
                            <option value="Digital Marketing Specialist">ğŸ’» Especialista en Marketing Digital</option>
                            <option value="Content Creator">âœï¸ Creador de Contenido</option>
                            <option value="Social Media Manager">ğŸ“¸ Community Manager</option>
                            <option value="Brand Manager">ğŸ¨ Gerente de Marca</option>
                            <option value="PR Specialist">ğŸ“° Especialista en RRPP</option>
                        </optgroup>

                        <!-- LEGAL Y JURÃDICO -->
                        <optgroup label="âš–ï¸ Legal y JurÃ­dico">
                            <option value="Lawyer">ğŸ‘¨â€ğŸ’¼ Abogado</option>
                            <option value="Paralegal">ğŸ“‹ Asistente Legal</option>
                            <option value="Judge">âš–ï¸ Juez</option>
                            <option value="Legal Advisor">ğŸ“œ Asesor Legal</option>
                            <option value="Notary">ğŸ›ï¸ Notario</option>
                        </optgroup>

                        <!-- INGENIERÃA Y CONSTRUCCIÃ“N -->
                        <optgroup label="ğŸ—ï¸ IngenierÃ­a y ConstrucciÃ³n">
                            <option value="Civil Engineer">ğŸ—ï¸ Ingeniero Civil</option>
                            <option value="Mechanical Engineer">âš™ï¸ Ingeniero MecÃ¡nico</option>
                            <option value="Electrical Engineer">âš¡ Ingeniero ElÃ©ctrico</option>
                            <option value="Architect">ğŸ›ï¸ Arquitecto</option>
                            <option value="Construction Manager">ğŸ‘·â€â™‚ï¸ Gerente de ConstrucciÃ³n</option>
                            <option value="Urban Planner">ğŸ™ï¸ Planificador Urbano</option>
                        </optgroup>

                        <!-- RECURSOS HUMANOS -->
                        <optgroup label="ğŸ‘¥ Recursos Humanos">
                            <option value="HR Manager">ğŸ‘¥ Gerente de RRHH</option>
                            <option value="Recruiter">ğŸ¯ Reclutador</option>
                            <option value="HR Analyst">ğŸ“Š Analista de RRHH</option>
                            <option value="Training Coordinator">ğŸ“š Coordinador de CapacitaciÃ³n</option>
                            <option value="Compensation Specialist">ğŸ’° Especialista en Compensaciones</option>
                        </optgroup>

                        <!-- COMUNICACIÃ“N Y MEDIOS -->
                        <optgroup label="ğŸ“º ComunicaciÃ³n y Medios">
                            <option value="Journalist">ğŸ“° Periodista</option>
                            <option value="Editor">âœï¸ Editor</option>
                            <option value="Photographer">ğŸ“¸ FotÃ³grafo</option>
                            <option value="Video Producer">ğŸ¬ Productor de Video</option>
                            <option value="Radio Host">ğŸ™ï¸ Locutor de Radio</option>
                            <option value="Translator">ğŸŒ Traductor</option>
                        </optgroup>

                        <!-- SERVICIOS Y ATENCIÃ“N AL CLIENTE -->
                        <optgroup label="ğŸ¤ Servicios y AtenciÃ³n">
                            <option value="Customer Service Representative">ğŸ“ Representante de AtenciÃ³n al Cliente</option>
                            <option value="Hotel Manager">ğŸ¨ Gerente de Hotel</option>
                            <option value="Travel Agent">âœˆï¸ Agente de Viajes</option>
                            <option value="Event Coordinator">ğŸ‰ Coordinador de Eventos</option>
                            <option value="Restaurant Manager">ğŸ½ï¸ Gerente de Restaurante</option>
                        </optgroup>

                        <!-- CIENCIAS E INVESTIGACIÃ“N -->
                        <optgroup label="ğŸ”¬ Ciencias e InvestigaciÃ³n">
                            <option value="Research Scientist">ğŸ”¬ CientÃ­fico Investigador</option>
                            <option value="Laboratory Technician">ğŸ§ª TÃ©cnico de Laboratorio</option>
                            <option value="Environmental Scientist">ğŸŒ± CientÃ­fico Ambiental</option>
                            <option value="Statistician">ğŸ“Š EstadÃ­stico</option>
                            <option value="Quality Control Analyst">âœ… Analista de Control de Calidad</option>
                        </optgroup>

                        <!-- ARTE Y CREATIVIDAD -->
                        <optgroup label="ğŸ¨ Arte y Creatividad">
                            <option value="Graphic Designer">ğŸ¨ DiseÃ±ador GrÃ¡fico</option>
                            <option value="Interior Designer">ğŸ  DiseÃ±ador de Interiores</option>
                            <option value="Musician">ğŸµ MÃºsico</option>
                            <option value="Artist">ğŸ–¼ï¸ Artista</option>
                            <option value="Fashion Designer">ğŸ‘— DiseÃ±ador de Moda</option>
                        </optgroup>

                        <!-- LOGÃSTICA Y TRANSPORTE -->
                        <optgroup label="ğŸšš LogÃ­stica y Transporte">
                            <option value="Logistics Coordinator">ğŸ“¦ Coordinador LogÃ­stico</option>
                            <option value="Supply Chain Manager">ğŸ”— Gerente de Cadena de Suministro</option>
                            <option value="Truck Driver">ğŸš› Conductor de CamiÃ³n</option>
                            <option value="Pilot">âœˆï¸ Piloto</option>
                            <option value="Warehouse Manager">ğŸ¬ Gerente de AlmacÃ©n</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Tipo de Entrevista -->
                <div class="config-section">
                    <label class="config-label">
                        <span class="label-icon">ğŸ¯</span>
                        <span class="label-text">Tipo de Entrevista</span>
                    </label>
                    <select @bind="SelectedInterviewType" class="config-select">
                        <option value="technical">ğŸ”§ TÃ©cnica</option>
                        <option value="soft_skills">ğŸ’¬ Habilidades Blandas</option>
                    </select>
                </div>

                <!-- Nivel de Dificultad -->
                <div class="config-section">
                    <label class="config-label">
                        <span class="label-icon">ğŸ“ˆ</span>
                        <span class="label-text">Nivel de Experiencia</span>
                    </label>
                    <select @bind="SelectedDifficulty" class="config-select">
                        <option value="junior">ğŸŒ± Junior (0-2 aÃ±os)</option>
                        <option value="mid">ğŸŒ³ Mid-Level (2-5 aÃ±os)</option>
                        <option value="senior">ğŸ¦… Senior (5+ aÃ±os)</option>
                    </select>
                </div>

                <!-- Modo de Entrevista -->
                <div class="config-section">
                    <label class="config-label">
                        <span class="label-icon">âš¡</span>
                        <span class="label-text">Modo</span>
                    </label>
                    <div class="modern-toggle-container">
                        <div class="toggle-labels">
                            <span class="toggle-label left @(!isExamMode ? "active" : "")">
                                <span class="label-icon">ğŸ“</span>
                                <span class="label-main">PrÃ¡ctica</span>
                                <span class="label-sub">Sin lÃ­mite de tiempo</span>
                            </span>
                            <span class="toggle-label right @(isExamMode ? "active" : "")">
                                <span class="label-icon">â±ï¸</span>
                                <span class="label-main">Examen</span>
                                <span class="label-sub">Con cronÃ³metro</span>
                            </span>
                        </div>
                        <div class="modern-toggle-switch" @onclick="ToggleExamMode">
                            <div class="toggle-track @(isExamMode ? "exam" : "practice")">
                                <div class="toggle-thumb @(isExamMode ? "right" : "left")">
                                    <span class="thumb-icon">@(isExamMode ? "â±ï¸" : "ğŸ“")</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BotÃ³n de Inicio -->
            <div class="config-actions">
                <button class="btn-start-interview @(IsConfigured ? "" : "disabled")" 
                        @onclick="StartInterview" 
                        disabled="@(!IsConfigured)">
                    <span class="btn-icon">ğŸš€</span>
                    <span class="btn-text">Iniciar Entrevista</span>
                </button>
                
                @if (!IsConfigured)
                {
                    <p class="config-warning">âš ï¸ Selecciona un rol para continuar</p>
                }
            </div>
        </div>
    }

    <!-- Ãrea de Mensajes -->
    @if (started)
    {
        <div class="chat-messages @(Messages.Count > 3 ? "expanded" : "")" @ref="chatMessagesContainer">
        @foreach (var message in Messages)
        {
                <div class="message-wrapper @(message.IsUser ? "user" : "assistant")">
                    <div class="message-avatar">
                        @if (message.IsUser)
                        {
                            <div class="user-avatar">@GetUserInitials()</div>
                        }
                        else
                        {
                            <div class="ai-avatar">ğŸ¤–</div>
                        }
                    </div>

                    <div class="message-content">
                        <div class="message-bubble">
                            <div class="message-text">@((MarkupString)FormatMessageMethod(message.Text))</div>
                        </div>
                        <div class="message-timestamp">@DateTime.Now.ToString("HH:mm")</div>
                    </div>
            </div>
        }
    </div>

        <!-- Mensaje de Error -->
        @if (!string.IsNullOrEmpty(errorMessage))
        {
            <div class="error-message">
                <div class="error-content">
                    <span class="error-icon">âš ï¸</span>
                    <span class="error-text">@errorMessage</span>
                    <button class="error-close" @onclick="() => errorMessage = null">Ã—</button>
                </div>
            </div>
        }

        <!-- Ãrea de Input -->
    <div class="chat-input-area">
        <div class="input-container">
                <textarea @bind="UserInput" 
                         @bind:event="oninput"
                         @onkeydown="HandleKeyDown"
                         @ref="inputTextArea"
                         class="chat-input" 
                    placeholder="Escribe tu respuesta aquÃ­... (Presiona Enter para enviar)"
                         rows="1"></textarea>
                
                <div class="input-actions">
                    <!-- BotÃ³n STT (Speech-to-Text) -->
                    <button class="btn-audio-stt @(isRecording ? "recording" : "")" 
                            @onclick="ToggleRecording" 
                            title="@(isRecording ? "Detener grabaciÃ³n" : "Grabar audio")">
                        @if (isRecording)
                        {
                            <svg class="audio-icon" viewBox="0 0 24 24" fill="currentColor">
                                <rect x="6" y="6" width="12" height="12" rx="2"/>
                            </svg>
                        }
                        else
                        {
                            <svg class="audio-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="m12 1-3 3h-3v8h3l3 3v-14z"/>
                                <path d="m16 9 5 5-5 5"/>
                            </svg>
                        }
                    </button>

                    <!-- BotÃ³n TTS (Text-to-Speech) -->
                    <button class="btn-audio-tts @(isPlayingTTS ? "playing" : "")" 
                            @onclick="ToggleTTS" 
                            disabled="@(Messages.Count == 0 || isPlayingTTS)"
                            title="@(isPlayingTTS ? "Reproduciendo..." : "Escuchar Ãºltimo mensaje")">
                        @if (isPlayingTTS)
                        {
                            <svg class="audio-icon" viewBox="0 0 24 24" fill="currentColor">
                                <circle cx="12" cy="12" r="3"/>
                                <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/>
                            </svg>
                        }
                        else
                        {
                            <svg class="audio-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                <path d="m19.07 4.93-5.14 5.14M14 10.5l5.14 5.14"/>
                            </svg>
                        }
                    </button>

                    <!-- BotÃ³n Enviar -->
                    <button class="btn-send @(CanSendMessage ? "" : "disabled")" 
                            @onclick="SendMessage" 
                            disabled="@(!CanSendMessage)">
                        <svg class="send-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="m22 2-7 20-4-9-9-4 20-7z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            @if (currentPhase == "completed")
            {
                <div class="completion-actions">
                    <button class="btn-end-interview" @onclick="EndInterview">
                        <span class="btn-icon">ğŸ¯</span>
                        <span class="btn-text">Ver Resumen Final</span>
                    </button>
                </div>
            }
            </div>
        }
</div>

<style>
    /* CSS especÃ­fico para esta pÃ¡gina */
    .modern-chat-container-full {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 100%;
        background: linear-gradient(135deg, #0a0e1a 0%, #1e293b 100%);
        color: #e2e8f0;
        overflow: hidden;
    }

    .chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(51, 65, 85, 0.3);
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .agent-avatar {
        position: relative;
    }

    .avatar-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
    }

    .status-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        background: #10b981;
        border-radius: 50%;
        border: 2px solid #0a0e1a;
    }

    .interview-config {
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
    }

    .config-header {
        text-align: center;
        margin-bottom: 2rem;
    }

    .config-header h2 {
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .config-grid {
        display: grid;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .config-section {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .config-label {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
        color: #e2e8f0;
    }

    .config-select {
        padding: 0.75rem;
        border-radius: 8px;
        border: 1px solid rgba(51, 65, 85, 0.5);
        background: rgba(30, 41, 59, 0.8);
        color: #e2e8f0;
        font-size: 1rem;
        transition: all 0.2s ease;
    }

    .config-select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Modern Toggle Switch */
    .modern-toggle-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: rgba(30, 41, 59, 0.3);
        border-radius: 12px;
        border: 1px solid rgba(59, 130, 246, 0.2);
        width: fit-content;
        margin: 0 auto;
    }

    /* Saludo centrado */
    .greeting-centered {
        text-align: center !important;
        margin: 0 auto;
        font-weight: 600;
        color: #60a5fa;
        font-size: 1.2rem;
        padding: 0.5rem 0;
    }

    .toggle-labels {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 2rem;
        margin-bottom: 0.5rem;
    }

    .toggle-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        opacity: 0.6;
        transition: all 0.3s ease;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 8px;
    }

    .toggle-label.active {
        opacity: 1;
        color: #60a5fa;
        background: rgba(59, 130, 246, 0.1);
    }

    .toggle-label .label-icon {
        font-size: 1.5rem;
        margin-bottom: 0.25rem;
    }

    .toggle-label .label-main {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 0.1rem;
    }

    .toggle-label .label-sub {
        font-size: 0.75rem;
        opacity: 0.8;
        text-align: center;
    }

    .modern-toggle-switch {
        cursor: pointer;
        user-select: none;
    }

    .toggle-track {
        width: 200px;
        height: 50px;
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        border-radius: 25px;
        position: relative;
        border: 2px solid rgba(59, 130, 246, 0.3);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        margin: 0 auto;
    }

    .toggle-track.practice {
        border-color: #10b981;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
    }

    .toggle-track.exam {
        border-color: #f59e0b;
        box-shadow: 0 0 20px rgba(245, 158, 11, 0.2);
    }

    .toggle-thumb {
        width: 46px;
        height: 46px;
        background: linear-gradient(135deg, #ffffff 0%, #f1f5f9 100%);
        border-radius: 50%;
        position: absolute;
        top: 2px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        border: 2px solid rgba(255, 255, 255, 0.2);
    }

    .toggle-thumb.left {
        left: 2px;
    }

    .toggle-thumb.right {
        left: calc(200px - 50px);
    }

    .thumb-icon {
        font-size: 1.2rem;
        transition: all 0.3s ease;
    }

    .toggle-track.practice .toggle-thumb {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .toggle-track.exam .toggle-thumb {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
    }

    .toggle-track.practice .thumb-icon {
        color: white;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
    }

    .toggle-track.exam .thumb-icon {
        color: white;
        filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
    }

    /* Hover Effects */
    .modern-toggle-switch:hover .toggle-track {
        transform: scale(1.02);
    }

    .modern-toggle-switch:hover .toggle-thumb {
        transform: scale(1.05);
    }

    .toggle-label:hover {
        opacity: 0.8;
        transform: translateY(-2px);
    }

    /* Animation cuando cambia */
    .toggle-track::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }

    .modern-toggle-switch:active .toggle-track::before {
        transform: translateX(100%);
    }

    .config-actions {
        text-align: center;
    }

    .btn-start-interview {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.2);
    }

    .btn-start-interview:hover:not(.disabled) {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    .btn-start-interview.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    .config-warning {
        color: #fbbf24;
        margin-top: 0.75rem;
        font-size: 0.875rem;
    }

    .error-message-config {
        background: linear-gradient(135deg, #dc2626 10%, #991b1b 90%);
        border: 1px solid rgba(220, 38, 38, 0.3);
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 1.5rem;
        animation: slideInDown 0.3s ease-out;
    }

    .error-content {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
    }

    .error-icon {
        font-size: 1.5rem;
        flex-shrink: 0;
    }

    .error-text {
        flex: 1;
        font-weight: 500;
        line-height: 1.4;
    }

    .error-actions {
        display: flex;
        justify-content: flex-end;
    }

    .btn-retry {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .btn-retry:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-1px);
    }

    @@keyframes slideInDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Ãrea de mensajes y chat */
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem 2rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        min-height: 300px;
        max-height: calc(100vh - 250px);
        transition: max-height 0.3s ease-in-out;
    }

    .chat-messages.expanded {
        max-height: calc(100vh - 180px);
    }

    .message-wrapper {
        display: flex;
        gap: 0.75rem;
        align-items: flex-start;
        max-width: 85%;
    }

    .message-wrapper.user {
        flex-direction: row-reverse;
        margin-left: auto;
    }

    .message-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .user-avatar {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
        font-weight: 600;
        font-size: 0.875rem;
    }

    .ai-avatar {
        background: linear-gradient(135deg, #10b981, #059669);
        font-size: 1.2rem;
    }

    .message-bubble {
        background: rgba(30, 41, 59, 0.8);
        padding: 0.75rem 1rem;
        border-radius: 12px;
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(51, 65, 85, 0.3);
    }

    .message-wrapper.user .message-bubble {
        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        color: white;
    }

    .message-text {
        font-size: 1.1rem;
        font-weight: 400;
        line-height: 1.5;
        text-align: left;
        word-wrap: break-word;
        white-space: pre-wrap;
    }

    .message-timestamp {
        font-size: 0.85rem;
        opacity: 0.6;
        margin-top: 0.25rem;
    }

    .chat-input-area {
        padding: 1rem 2rem 1.5rem;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-top: 1px solid rgba(51, 65, 85, 0.3);
    }

    .input-container {
        display: flex;
        gap: 0.75rem;
        align-items: flex-end;
    }

    .chat-input {
        flex: 1;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        border: 1px solid rgba(51, 65, 85, 0.5);
        background: rgba(30, 41, 59, 0.8);
        color: #e2e8f0;
        resize: none;
        min-height: 44px;
        max-height: 120px;
        font-family: inherit;
        transition: all 0.2s ease;
    }

    .chat-input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn-send {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        border: none;
        padding: 0.75rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .btn-send:hover:not(.disabled) {
        transform: scale(1.05);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-send.disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }

    .send-icon {
        width: 20px;
        height: 20px;
    }

    /* Botones de Audio */
    .btn-audio-stt, .btn-audio-tts {
        background: rgba(71, 85, 105, 0.8);
        border: 1px solid rgba(148, 163, 184, 0.3);
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
        flex-shrink: 0;
        color: #e2e8f0;
        margin-right: 0.5rem;
    }

    .btn-audio-stt:hover, .btn-audio-tts:hover {
        background: rgba(100, 116, 139, 0.9);
        border-color: rgba(148, 163, 184, 0.5);
        transform: scale(1.05);
    }

    .btn-audio-stt.recording {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        border-color: rgba(239, 68, 68, 0.5);
        animation: pulse-recording 1.5s infinite;
    }

    .btn-audio-tts.playing {
        background: linear-gradient(135deg, #10b981, #059669);
        border-color: rgba(16, 185, 129, 0.5);
        animation: pulse-playing 1s infinite;
    }

    .btn-audio-stt:disabled, .btn-audio-tts:disabled {
        background: rgba(71, 85, 105, 0.3);
        border-color: rgba(148, 163, 184, 0.2);
        cursor: not-allowed;
        transform: none;
        opacity: 0.5;
    }

    .audio-icon {
        width: 1rem;
        height: 1rem;
        color: currentColor;
    }

    @@keyframes pulse-recording {
        0%, 100% { 
            box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
        }
        50% { 
            box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
        }
    }

    @@keyframes pulse-playing {
        0%, 100% { 
            box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        50% { 
            box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
        }
    }

    .completion-actions {
        margin-top: 1rem;
        text-align: center;
    }

    .btn-end-interview {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-end-interview:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
    }

    /* Progress indicators */
    .phase-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .phase-badge.context {
        background: rgba(251, 191, 36, 0.2);
        color: #fbbf24;
    }

    .phase-badge.interview {
        background: rgba(59, 130, 246, 0.2);
        color: #60a5fa;
    }

    .phase-badge.completed {
        background: rgba(16, 185, 129, 0.2);
        color: #34d399;
    }

    .timer-display {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: rgba(30, 41, 59, 0.8);
        padding: 0.5rem 0.75rem;
        border-radius: 8px;
        font-weight: 600;
        color: #fbbf24;
    }

    /* Mensaje de Error */
    .error-message {
        position: fixed;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        max-width: 500px;
        animation: slideDown 0.3s ease-out;
    }

    .error-content {
        background: rgba(239, 68, 68, 0.95);
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .error-icon {
        font-size: 1.2rem;
        flex-shrink: 0;
    }

    .error-text {
        flex: 1;
        font-size: 0.875rem;
        font-weight: 500;
    }

    .error-close {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        padding: 0;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background-color 0.2s ease;
    }

    .error-close:hover {
        background: rgba(255, 255, 255, 0.2);
    }

    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(-1rem);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }
</style>
