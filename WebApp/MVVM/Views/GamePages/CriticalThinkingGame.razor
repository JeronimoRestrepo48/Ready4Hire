@page "/game/critical-thinking"
@using Microsoft.AspNetCore.Components
@using Ready4Hire.Services
@inject AuthService AuthService
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>üß† Pensamiento Cr√≠tico - Ready4Hire</PageTitle>

<div class="game-container">
    <div class="game-header">
        <button class="btn-back" @onclick="GoBack">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Volver
        </button>
        <div class="game-stats-bar">
            <span class="stat-item">üß† Caso @currentCase/@totalCases</span>
            <span class="stat-item">üèÜ @currentScore pts</span>
            <span class="stat-item">üìä An√°lisis: @(Math.Round(analysisQuality * 100))%</span>
        </div>
    </div>

    @if (!gameStarted)
    {
        <div class="game-intro">
            <div class="intro-icon">üß†</div>
            <h1>Pensamiento Cr√≠tico</h1>
            <p>Analiza informaci√≥n, eval√∫a argumentos y toma decisiones fundamentadas</p>
            <div class="game-rules">
                <h3>üéØ Habilidades clave:</h3>
                <ul>
                    <li>üîç <strong>An√°lisis de argumentos:</strong> Identificar premisas y conclusiones</li>
                    <li>üìä <strong>Evaluaci√≥n de evidencia:</strong> Determinar relevancia y validez</li>
                    <li>‚öñÔ∏è <strong>Detecci√≥n de sesgos:</strong> Reconocer falacias l√≥gicas</li>
                    <li>üí≠ <strong>Razonamiento inductivo/deductivo:</strong> Inferencias v√°lidas</li>
                    <li>üéØ <strong>Toma de decisiones:</strong> Conclusiones bien fundamentadas</li>
                </ul>

                <div class="thinking-framework">
                    <h4>üî¨ Marco de an√°lisis:</h4>
                    <p>‚Ä¢ <strong>Identificar:</strong> ¬øCu√°l es la afirmaci√≥n principal?</p>
                    <p>‚Ä¢ <strong>Evidenciar:</strong> ¬øQu√© evidencia se presenta?</p>
                    <p>‚Ä¢ <strong>Evaluar:</strong> ¬øEs la evidencia confiable y relevante?</p>
                    <p>‚Ä¢ <strong>Inferir:</strong> ¬øQu√© conclusiones son v√°lidas?</p>
                    <p>‚Ä¢ <strong>Decidir:</strong> ¬øCu√°l es la mejor respuesta fundamentada?</p>
                </div>
            </div>
            <div class="difficulty-selector">
                <h4>Nivel de an√°lisis:</h4>
                <div class="difficulty-options">
                    <button class="difficulty-btn @(selectedDifficulty == "junior" ? "selected" : "")" 
                            @onclick='() => SelectDifficulty("junior")'>
                        <span>üü¢ Analista</span>
                        <small>2 casos, argumentos directos</small>
                    </button>
                    <button class="difficulty-btn @(selectedDifficulty == "mid" ? "selected" : "")" 
                            @onclick='() => SelectDifficulty("mid")'>
                        <span>üü° Investigador</span>
                        <small>3 casos, sesgos complejos</small>
                    </button>
                    <button class="difficulty-btn @(selectedDifficulty == "senior" ? "selected" : "")" 
                            @onclick='() => SelectDifficulty("senior")'>
                        <span>üî¥ Fil√≥sofo</span>
                        <small>4 casos, razonamiento avanzado</small>
                    </button>
                </div>
            </div>
            <button class="btn-start-game" @onclick="StartGame" disabled="@(selectedDifficulty == null)">
                üß† Comenzar An√°lisis
            </button>
        </div>
    }
    else if (gameFinished)
    {
        <div class="game-results">
            <div class="results-icon">@GetThinkingIcon()</div>
            <h2>¬°An√°lisis Completado!</h2>
            <div class="thinking-assessment">
                <h3>@GetThinkingRating()</h3>
                <p>@GetThinkingDescription()</p>
            </div>
            <div class="results-stats">
                <div class="result-stat highlight">
                    <span class="result-label">Puntuaci√≥n Final</span>
                    <span class="result-value">@currentScore pts</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Casos Analizados</span>
                    <span class="result-value">@casesCompleted/@totalCases</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Calidad de An√°lisis</span>
                    <span class="result-value">@(Math.Round(analysisQuality * 100))%</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Estilo de Pensamiento</span>
                    <span class="result-value">@GetThinkingStyle()</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Detecci√≥n de Sesgos</span>
                    <span class="result-value">@GetBiasDetection()</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Nivel Cognitivo</span>
                    <span class="result-value">@GetCognitiveLevel()</span>
                </div>
            </div>
            <div class="results-actions">
                <button class="btn-restart" @onclick="RestartGame">
                    üîÑ Nuevo An√°lisis
                </button>
                <button class="btn-gamification" @onclick="GoToGamification">
                    üéÆ Ver M√°s Juegos
                </button>
            </div>
        </div>
    }
    else
    {
        <div class="game-content">
            <div class="case-container">
                <div class="case-header">
                    <h2>Caso @currentCase: @currentCaseData.Title</h2>
                    <div class="case-type">üîç @currentCaseData.Type</div>
                </div>

                <div class="case-statement">
                    <h4>üìã Afirmaci√≥n/Argumento:</h4>
                    <div class="statement-content">
                        <p>@currentCaseData.Statement</p>
                    </div>
                </div>

                <div class="evidence-section">
                    <h4>üìä Evidencia presentada:</h4>
                    <div class="evidence-list">
                        @foreach (var evidence in currentCaseData.Evidence)
                        {
                            <div class="evidence-item">
                                <span class="evidence-bullet">‚Ä¢</span>
                                <span class="evidence-text">@evidence</span>
                            </div>
                        }
                    </div>
                </div>

                @if (currentCaseData.PotentialBiases.Any())
                {
                    <div class="bias-section">
                        <h4>‚ö†Ô∏è Posibles sesgos a considerar:</h4>
                        <div class="bias-list">
                            @foreach (var bias in currentCaseData.PotentialBiases)
                            {
                                <div class="bias-item">@bias</div>
                            }
                        </div>
                    </div>
                }

                <div class="analysis-questions">
                    <h4>üî¨ Pregunta de an√°lisis:</h4>
                    <div class="question-content">
                        <p>@currentCaseData.Question</p>
                    </div>
                </div>

                @if (!showingResult)
                {
                    <div class="response-section">
                        <h4>Tu an√°lisis:</h4>
                        <div class="analysis-options">
                            @for (int i = 0; i < currentCaseData.Options.Count; i++)
                            {
                                var index = i;
                                var option = currentCaseData.Options[index];
                                <button class="analysis-btn @(selectedAnalysis == index ? "selected" : "")"
                                        @onclick="() => SelectAnalysis(index)"
                                        disabled="@showingResult">
                                    <div class="option-header">
                                        <span class="option-icon">@GetAnalysisIcon(option.Type)</span>
                                        <span class="option-title">@option.Title</span>
                                    </div>
                                    <div class="option-reasoning">@option.Reasoning</div>
                                </button>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <div class="analysis-result">
                        <div class="result-header">
                            <div class="result-icon">
                                @if (selectedAnalysisResult.IsCorrect)
                                {
                                    <span>üéØ</span>
                                }
                                else
                                {
                                    <span>ü§î</span>
                                }
                            </div>
                            <div class="result-title">
                                <h4>@selectedAnalysisResult.Feedback</h4>
                                <div class="result-score">+@lastCasePoints pts</div>
                            </div>
                        </div>
                        
                        <div class="detailed-analysis">
                            <div class="analysis-section">
                                <h5>üí≠ Tu razonamiento:</h5>
                                <p>@selectedAnalysisResult.UserReasoning</p>
                            </div>
                            
                            <div class="analysis-section">
                                <h5>‚úÖ An√°lisis correcto:</h5>
                                <p>@selectedAnalysisResult.CorrectAnalysis</p>
                            </div>
                            
                            @if (!string.IsNullOrEmpty(selectedAnalysisResult.KeyInsight))
                            {
                                <div class="analysis-section insight">
                                    <h5>üí° Punto clave:</h5>
                                    <p>@selectedAnalysisResult.KeyInsight</p>
                                </div>
                            }
                        </div>

                        <div class="cognitive-metrics">
                            <h5>üß† Evaluaci√≥n cognitiva:</h5>
                            <div class="metrics-grid">
                                <div class="metric-item">
                                    <span class="metric-label">L√≥gica:</span>
                                    <span class="metric-value @GetMetricClass(selectedAnalysisResult.LogicScore)">@selectedAnalysisResult.LogicScore/5</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Evidencia:</span>
                                    <span class="metric-value @GetMetricClass(selectedAnalysisResult.EvidenceScore)">@selectedAnalysisResult.EvidenceScore/5</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Sesgos:</span>
                                    <span class="metric-value @GetMetricClass(selectedAnalysisResult.BiasScore)">@selectedAnalysisResult.BiasScore/5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <div class="case-actions">
                    @if (!showingResult)
                    {
                        <button class="btn-submit-analysis" @onclick="SubmitAnalysis" disabled="@(selectedAnalysis == -1)">
                            üéØ Presentar An√°lisis
                        </button>
                        <button class="btn-think-deeper" @onclick="ShowThinkingTip">
                            ü§î Pensar M√°s Profundo
                        </button>
                    }
                    else
                    {
                        @if (currentCase < totalCases)
                        {
                            <button class="btn-next-case" @onclick="NextCase">
                                Siguiente Caso ‚û°Ô∏è
                            </button>
                        }
                        else
                        {
                            <button class="btn-complete-analysis" @onclick="CompleteAnalysis">
                                üèÜ Completar An√°lisis
                            </button>
                        }
                    }
                </div>

                @if (!string.IsNullOrEmpty(thinkingTip))
                {
                    <div class="thinking-tip">
                        <div class="tip-icon">ü§î</div>
                        <div class="tip-content">
                            <h5>Marco de pensamiento cr√≠tico:</h5>
                            <p>@thinkingTip</p>
                        </div>
                    </div>
                }
            </div>
        </div>
    }
</div>

@code {
    private bool gameStarted = false;
    private bool gameFinished = false;
    private bool showingResult = false;
    private int selectedAnalysis = -1;

    private int currentCase = 1;
    private int totalCases = 3;
    private int currentScore = 0;
    private int casesCompleted = 0;
    private int lastCasePoints = 0;

    private double analysisQuality = 0;
    private List<double> caseScores = new();

    private string? selectedDifficulty = null;
    private string thinkingTip = "";

    private CaseData currentCaseData = new();
    private AnalysisResult selectedAnalysisResult = new();

    public class CaseData
    {
        public string Title { get; set; } = "";
        public string Type { get; set; } = "";
        public string Statement { get; set; } = "";
        public List<string> Evidence { get; set; } = new();
        public List<string> PotentialBiases { get; set; } = new();
        public string Question { get; set; } = "";
        public List<AnalysisOption> Options { get; set; } = new();
    }

    public class AnalysisOption
    {
        public string Title { get; set; } = "";
        public string Reasoning { get; set; } = "";
        public string Type { get; set; } = "";
        public AnalysisResult Result { get; set; } = new();
    }

    public class AnalysisResult
    {
        public string Feedback { get; set; } = "";
        public string UserReasoning { get; set; } = "";
        public string CorrectAnalysis { get; set; } = "";
        public string KeyInsight { get; set; } = "";
        public bool IsCorrect { get; set; } = false;
        public int Points { get; set; } = 0;
        public int LogicScore { get; set; } = 3;
        public int EvidenceScore { get; set; } = 3;
        public int BiasScore { get; set; } = 3;
    }

    protected override async Task OnInitializedAsync()
    {
        if (!await AuthService.IsAuthenticatedAsync())
        {
            Navigation.NavigateTo("/", true);
        }
    }

    private void SelectDifficulty(string difficulty)
    {
        selectedDifficulty = difficulty;
        totalCases = difficulty switch
        {
            "junior" => 2,
            "mid" => 3,
            "senior" => 4,
            _ => 3
        };
        StateHasChanged();
    }

    private void StartGame()
    {
        if (selectedDifficulty == null) return;

        gameStarted = true;
        currentCase = 1;
        currentScore = 0;
        casesCompleted = 0;
        caseScores.Clear();

        GenerateCase();
        StateHasChanged();
    }

    private void GenerateCase()
    {
        selectedAnalysis = -1;
        showingResult = false;
        thinkingTip = "";

        var cases = GetCasesByDifficulty(selectedDifficulty ?? "mid");
        currentCaseData = cases[new Random().Next(cases.Length)];
    }

    private CaseData[] GetCasesByDifficulty(string difficulty)
    {
        var cases = new[]
        {
            new CaseData
            {
                Title = "Eficacia de Suplementos",
                Type = "Evaluaci√≥n de Evidencia",
                Statement = "Un nuevo suplemento vitam√≠nico aumenta la energ√≠a en un 200% seg√∫n estudios cient√≠ficos.",
                Evidence = new List<string>
                {
                    "Estudio realizado en 100 personas durante 2 semanas",
                    "Patrocinado por la empresa que vende el suplemento",
                    "Los participantes reportaron 'sentirse m√°s energ√©ticos'",
                    "No hubo grupo de control con placebo",
                    "Los resultados se midieron mediante encuestas subjetivas"
                },
                PotentialBiases = new List<string>
                {
                    "Sesgo de confirmaci√≥n", "Conflicto de intereses", "Efecto placebo"
                },
                Question = "¬øQu√© tan confiables son las conclusiones del estudio?",
                Options = new List<AnalysisOption>
                {
                    new AnalysisOption
                    {
                        Title = "Altamente confiables",
                        Reasoning = "El estudio fue realizado en personas reales y los resultados son claros",
                        Type = "Acr√≠tico",
                        Result = new AnalysisResult
                        {
                            Feedback = "An√°lisis superficial",
                            UserReasoning = "Aceptaste los resultados sin cuestionar la metodolog√≠a",
                            CorrectAnalysis = "Los estudios requieren metodolog√≠a rigurosa, incluyendo grupos de control y mediciones objetivas",
                            KeyInsight = "Siempre eval√∫a la metodolog√≠a antes de aceptar conclusiones",
                            IsCorrect = false,
                            Points = 20,
                            LogicScore = 2,
                            EvidenceScore = 1,
                            BiasScore = 1
                        }
                    },
                    new AnalysisOption
                    {
                        Title = "Poco confiables",
                        Reasoning = "M√∫ltiples problemas metodol√≥gicos: falta de control, sesgo del patrocinador, mediciones subjetivas",
                        Type = "Cr√≠tico",
                        Result = new AnalysisResult
                        {
                            Feedback = "Excelente an√°lisis cr√≠tico",
                            UserReasoning = "Identificaste correctamente los problemas metodol√≥gicos clave",
                            CorrectAnalysis = "La falta de grupo control, el conflicto de intereses y las mediciones subjetivas hacen los resultados poco confiables",
                            KeyInsight = "La calidad de la evidencia depende de la rigurosidad metodol√≥gica",
                            IsCorrect = true,
                            Points = 100,
                            LogicScore = 5,
                            EvidenceScore = 5,
                            BiasScore = 4
                        }
                    },
                    new AnalysisOption
                    {
                        Title = "Moderadamente confiables",
                        Reasoning = "Aunque hay algunos problemas, el estudio tiene m√©rito cient√≠fico",
                        Type = "Moderado",
                        Result = new AnalysisResult
                        {
                            Feedback = "An√°lisis parcialmente correcto",
                            UserReasoning = "Reconociste algunos problemas pero subestimaste su impacto",
                            CorrectAnalysis = "Los problemas metodol√≥gicos son tan significativos que comprometen severamente la validez",
                            KeyInsight = "En ciencia, los defectos metodol√≥gicos mayores invalidan las conclusiones",
                            IsCorrect = false,
                            Points = 60,
                            LogicScore = 3,
                            EvidenceScore = 3,
                            BiasScore = 3
                        }
                    }
                }
            }
        };

        return cases;
    }

    private void SelectAnalysis(int index)
    {
        selectedAnalysis = index;
        StateHasChanged();
    }

    private void SubmitAnalysis()
    {
        if (selectedAnalysis == -1) return;

        var selectedOption = currentCaseData.Options[selectedAnalysis];
        selectedAnalysisResult = selectedOption.Result;
        
        lastCasePoints = selectedAnalysisResult.Points;
        currentScore += lastCasePoints;
        
        if (selectedAnalysisResult.IsCorrect)
        {
            casesCompleted++;
        }

        // Calcular calidad de an√°lisis
        var qualityScore = (selectedAnalysisResult.LogicScore + selectedAnalysisResult.EvidenceScore + selectedAnalysisResult.BiasScore) / 15.0;
        caseScores.Add(qualityScore);
        analysisQuality = caseScores.Average();

        showingResult = true;
        StateHasChanged();
    }

    private void ShowThinkingTip()
    {
        var tips = new[]
        {
            "Preg√∫ntate: ¬øQui√©n se beneficia de esta conclusi√≥n? ¬øHay conflictos de inter√©s?",
            "Eval√∫a la fuente: ¬øEs cre√≠ble, imparcial y tiene experiencia relevante?",
            "Busca lo que falta: ¬øQu√© informaci√≥n omitida podr√≠a cambiar la conclusi√≥n?",
            "Considera alternativas: ¬øHay otras explicaciones igualmente v√°lidas?",
            "Distingue entre correlaci√≥n y causalidad: ¬øA realmente causa B?",
            "Eval√∫a la muestra: ¬øEs representativa y suficientemente grande?",
            "Cuestiona las generalizaciones: ¬øSe puede aplicar a todos los casos?",
            "Identifica emociones vs. l√≥gica: ¬øEl argumento apela a emociones o raz√≥n?"
        };

        thinkingTip = tips[new Random().Next(tips.Length)];
        StateHasChanged();

        Task.Delay(10000).ContinueWith(_ => InvokeAsync(() =>
        {
            thinkingTip = "";
            StateHasChanged();
        }));
    }

    private void NextCase()
    {
        currentCase++;
        GenerateCase();
        StateHasChanged();
    }

    private void CompleteAnalysis()
    {
        gameFinished = true;
        StateHasChanged();
    }

    private void RestartGame()
    {
        gameFinished = false;
        gameStarted = false;
        selectedDifficulty = null;
        StateHasChanged();
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/gamification", false);
    }

    private void GoToGamification()
    {
        Navigation.NavigateTo("/gamification", false);
    }

    private string GetAnalysisIcon(string type)
    {
        return type switch
        {
            "Cr√≠tico" => "üéØ",
            "Acr√≠tico" => "üò¥",
            "Moderado" => "‚öñÔ∏è",
            "Esc√©ptico" => "ü§î",
            _ => "üí≠"
        };
    }

    private string GetMetricClass(int score)
    {
        return score switch
        {
            >= 4 => "metric-high",
            >= 3 => "metric-medium",
            _ => "metric-low"
        };
    }

    private string GetThinkingIcon()
    {
        return analysisQuality switch
        {
            >= 0.8 => "üß†",
            >= 0.6 => "üéØ",
            >= 0.4 => "ü§î",
            _ => "üí≠"
        };
    }

    private string GetThinkingRating()
    {
        return analysisQuality switch
        {
            >= 0.8 => "Pensador Cr√≠tico Excepcional",
            >= 0.6 => "Analista Competente",
            >= 0.4 => "Pensador en Desarrollo",
            _ => "Aprendiz de An√°lisis"
        };
    }

    private string GetThinkingDescription()
    {
        return analysisQuality switch
        {
            >= 0.8 => "Demuestras habilidades excepcionales de pensamiento cr√≠tico. Puedes identificar sesgos, evaluar evidencia y llegar a conclusiones bien fundamentadas.",
            >= 0.6 => "Tienes bases s√≥lidas de an√°lisis cr√≠tico. Con pr√°ctica adicional puedes perfeccionar tu capacidad de detectar falacias l√≥gicas.",
            >= 0.4 => "Est√°s desarrollando habilidades de pensamiento cr√≠tico. Enf√≥cate en cuestionar las fuentes y buscar evidencia alternativa.",
            _ => "El pensamiento cr√≠tico se desarrolla con pr√°ctica. Comienza cuestionando las afirmaciones y buscando evidencia de apoyo."
        };
    }

    private string GetThinkingStyle()
    {
        return analysisQuality switch
        {
            >= 0.7 => "Anal√≠tico",
            >= 0.5 => "Reflexivo",
            _ => "Intuitivo"
        };
    }

    private string GetBiasDetection()
    {
        var avgBiasScore = caseScores.Count > 0 ? selectedAnalysisResult.BiasScore : 3;
        return avgBiasScore switch
        {
            >= 4 => "Experto",
            >= 3 => "Competente",
            _ => "En desarrollo"
        };
    }

    private string GetCognitiveLevel()
    {
        return analysisQuality switch
        {
            >= 0.8 => "Metacognitivo",
            >= 0.6 => "Anal√≠tico",
            >= 0.4 => "Aplicado",
            _ => "B√°sico"
        };
    }
}

<style>
    .game-container {
        background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        min-height: 100vh;
        color: #ffffff;
        font-family: 'Segoe UI', system-ui, sans-serif;
    }

    .game-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        flex-wrap: wrap;
        gap: 1rem;
    }

    .btn-back {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: transparent;
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #ffffff;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .game-stats-bar {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .stat-item {
        font-weight: 500;
        font-size: 0.85rem;
        padding: 0.3rem 0.8rem;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        white-space: nowrap;
    }

    .game-intro {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 80px);
        text-align: center;
        padding: 2rem;
    }

    .intro-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        animation: think-pulse 2s ease-in-out infinite;
    }

    @@keyframes think-pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.08); }
    }

    .game-intro h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        background: linear-gradient(45deg, #ffffff 0%, #3498db 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .thinking-framework {
        background: rgba(52, 152, 219, 0.1);
        padding: 1rem;
        border-radius: 8px;
        border: 1px solid rgba(52, 152, 219, 0.3);
        margin-top: 1rem;
    }

    .game-content {
        padding: 2rem;
        max-width: 1000px;
        margin: 0 auto;
        min-height: calc(100vh - 140px);
    }

    .case-container {
        background: rgba(0, 0, 0, 0.15);
        border-radius: 16px;
        padding: 2rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .case-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .case-statement {
        background: rgba(52, 152, 219, 0.1);
        padding: 1.5rem;
        border-radius: 12px;
        margin-bottom: 1.5rem;
        border-left: 4px solid #3498db;
    }

    .statement-content {
        margin-top: 0.8rem;
        font-size: 1.1rem;
        line-height: 1.6;
        color: #e8f4fd;
    }

    .evidence-section, .bias-section, .analysis-questions {
        margin-bottom: 1.5rem;
    }

    .evidence-section h4, .bias-section h4, .analysis-questions h4 {
        color: #3498db;
        margin-bottom: 1rem;
    }

    .evidence-list {
        background: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 8px;
    }

    .evidence-item {
        display: flex;
        align-items: flex-start;
        gap: 0.8rem;
        margin-bottom: 0.8rem;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 6px;
    }

    .evidence-bullet {
        color: #3498db;
        font-weight: bold;
        margin-top: 0.2rem;
    }

    .bias-list {
        display: flex;
        gap: 0.8rem;
        flex-wrap: wrap;
    }

    .bias-item {
        background: rgba(243, 156, 18, 0.2);
        color: #f39c12;
        padding: 0.4rem 0.8rem;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .question-content {
        background: rgba(46, 204, 113, 0.1);
        padding: 1rem;
        border-radius: 8px;
        border-left: 4px solid #2ecc71;
        font-size: 1.1rem;
        font-weight: 500;
        color: #e8f8f5;
    }

    .analysis-options {
        display: grid;
        gap: 1rem;
        margin-top: 1rem;
    }

    .analysis-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.2s;
        text-align: left;
        color: white;
    }

    .analysis-btn.selected {
        background: rgba(52, 152, 219, 0.2);
        border-color: #3498db;
    }

    .option-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.8rem;
    }

    .option-icon {
        font-size: 1.3rem;
    }

    .option-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #3498db;
    }

    .option-reasoning {
        color: #e8e8e8;
        line-height: 1.4;
        font-size: 0.95rem;
    }

    .analysis-result {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 2rem;
        margin: 2rem 0;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .result-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .result-icon {
        font-size: 2rem;
    }

    .result-title h4 {
        color: #3498db;
        margin: 0 0 0.3rem 0;
    }

    .result-score {
        color: #2ecc71;
        font-weight: 600;
    }

    .detailed-analysis {
        margin-bottom: 1.5rem;
    }

    .analysis-section {
        margin-bottom: 1rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 8px;
    }

    .analysis-section.insight {
        background: rgba(243, 156, 18, 0.1);
        border-left: 4px solid #f39c12;
    }

    .analysis-section h5 {
        color: #3498db;
        margin: 0 0 0.5rem 0;
        font-size: 0.9rem;
    }

    .analysis-section.insight h5 {
        color: #f39c12;
    }

    .cognitive-metrics h5 {
        color: #3498db;
        margin-bottom: 1rem;
    }

    .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
    }

    .metric-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 0.8rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }

    .metric-label {
        font-size: 0.8rem;
        color: #b0b0b0;
        margin-bottom: 0.3rem;
    }

    .metric-value {
        font-weight: 600;
        font-size: 1.1rem;
    }

    .metric-high {
        color: #2ecc71;
    }

    .metric-medium {
        color: #f39c12;
    }

    .metric-low {
        color: #e74c3c;
    }

    .case-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
        margin: 2rem 0;
    }

    .btn-submit-analysis, .btn-think-deeper, .btn-next-case, .btn-complete-analysis {
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-size: 1rem;
    }

    .btn-submit-analysis {
        background: linear-gradient(45deg, #3498db 0%, #2980b9 100%);
        color: white;
    }

    .btn-think-deeper {
        background: rgba(243, 156, 18, 0.2);
        color: #f39c12;
        border: 1px solid rgba(243, 156, 18, 0.3);
    }

    .btn-next-case {
        background: linear-gradient(45deg, #2ecc71 0%, #27ae60 100%);
        color: white;
    }

    .btn-complete-analysis {
        background: linear-gradient(45deg, #9b59b6 0%, #8e44ad 100%);
        color: white;
    }

    .thinking-tip {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        background: rgba(243, 156, 18, 0.1);
        padding: 1.2rem;
        border-radius: 8px;
        border: 1px solid rgba(243, 156, 18, 0.3);
        margin-top: 1rem;
    }

    .tip-icon {
        font-size: 1.5rem;
        color: #f39c12;
        margin-top: 0.2rem;
    }

    .tip-content h5 {
        color: #f39c12;
        margin: 0 0 0.5rem 0;
    }

    .tip-content p {
        color: #f39c12;
        margin: 0;
        line-height: 1.4;
    }

    .game-results {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: calc(100vh - 80px);
        text-align: center;
        padding: 2rem;
    }

    .results-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .game-results h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(45deg, #3498db 0%, #2980b9 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .thinking-assessment {
        margin-bottom: 2rem;
        max-width: 600px;
    }

    .thinking-assessment h3 {
        color: #3498db;
        margin-bottom: 0.5rem;
    }

    .results-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
        width: 100%;
        max-width: 1000px;
    }

    .result-stat {
        background: rgba(0, 0, 0, 0.15);
        padding: 1.2rem;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .result-stat.highlight {
        background: rgba(52, 152, 219, 0.1);
        border-color: #3498db;
    }

    .result-label {
        display: block;
        color: #b0b0b0;
        font-size: 0.85rem;
        margin-bottom: 0.5rem;
    }

    .result-value {
        display: block;
        font-size: 1.3rem;
        font-weight: 600;
        color: #3498db;
    }

    .results-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        justify-content: center;
    }

    .btn-restart, .btn-gamification {
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        font-size: 1rem;
    }

    .btn-restart {
        background: linear-gradient(45deg, #3498db 0%, #2980b9 100%);
        color: white;
    }

    .btn-gamification {
        background: transparent;
        color: #e8e8e8;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
</style>
