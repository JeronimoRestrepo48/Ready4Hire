# ══════════════════════════════════════════════════════════════════════════════
# Ready4Hire - Docker Secrets Configuration
# ══════════════════════════════════════════════════════════════════════════════
#
# This file shows how to use Docker Secrets for sensitive data.
# In production, use: docker secret create <name> <file>
#
# Example:
#   echo "my_secret_password" | docker secret create postgres_password -
#   echo "my_jwt_secret_key" | docker secret create jwt_secret -
#
# ══════════════════════════════════════════════════════════════════════════════

version: '3.8'

# ══════════════════════════════════════════════════════════════════════════════
# SECRETS (Create with: docker secret create <name> <file>)
# ══════════════════════════════════════════════════════════════════════════════

secrets:
  postgres_password:
    external: true
  jwt_secret_key:
    external: true
  redis_password:
    external: false  # Optional
  sentry_dsn:
    external: true

# ══════════════════════════════════════════════════════════════════════════════
# SERVICES WITH SECRETS
# ══════════════════════════════════════════════════════════════════════════════

services:
  postgres:
    image: postgres:15-alpine
    secrets:
      - postgres_password
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/postgres_password
      # Use POSTGRES_PASSWORD_FILE instead of POSTGRES_PASSWORD
    # ... rest of config

  api:
    build:
      context: ./Ready4Hire
      dockerfile: Dockerfile
    secrets:
      - jwt_secret_key
      - sentry_dsn
    environment:
      JWT_SECRET_KEY_FILE: /run/secrets/jwt_secret_key
      SENTRY_DSN_FILE: /run/secrets/sentry_dsn
    # ... rest of config

# ══════════════════════════════════════════════════════════════════════════════
# HOW TO USE:
# ══════════════════════════════════════════════════════════════════════════════
#
# 1. Create secrets:
#    echo "your_secure_password" | docker secret create postgres_password -
#    echo "your_jwt_secret_key_32_chars_min" | docker secret create jwt_secret_key -
#
# 2. Update services to read from secrets:
#    In your service, read from /run/secrets/<secret_name>
#
# 3. Alternative: Use Docker Compose secrets (simpler):
#    secrets:
#      postgres_password:
#        file: ./secrets/postgres_password.txt
#
# ══════════════════════════════════════════════════════════════════════════════

